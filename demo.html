<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ASSIGNME - Démo</title>
  
  <!-- React et Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="favicon.png" rel="icon" type="image/png">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Space Grotesk', 'ui-sans-serif', 'system-ui'] },
          colors: {
            base: '#0a0b10',
            ink: '#eaf2ff',
            muted: '#a9b9d6',
            neon: '#95D2E6'
          },
          boxShadow: { glow: '0 0 80px rgba(149, 210, 230, 0.35)' }
        }
      }
    }
  </script>
  
  <style>
    html, body { background:#0a0b10; color:#eaf2ff; }
    .glass { backdrop-filter: blur(10px); background: rgba(16,18,27,.45); border: 1px solid rgba(149,210,230,.18); }
    .hero-gradient { background-image: radial-gradient(1200px 600px at 60% -10%, rgba(149,210,230,.18), rgba(149,210,230,.10) 35%, rgba(10,11,16,1) 65%); }
    .nav-brand { color:#ffffff !important; }
    .footer-brand { color:#ffffff !important; }
    .chip { background: linear-gradient(135deg, rgba(149,210,230,.18), rgba(207,230,228,.10)); border: 1px solid rgba(149,210,230,.25); }
  </style>
</head>
<body class="font-sans antialiased selection:bg-accent/30">
  
  <!-- Header -->
  <header class="fixed top-0 inset-x-0 z-50">
    <nav class="glass mx-auto mt-4 w-[min(1100px,92%)] rounded-2xl px-4 sm:px-6 py-3 flex items-center justify-between">
      <div class="flex items-center gap-8">
        <a href="index.html" class="flex items-center gap-2">
          <img src="logo.png" alt="ASSIGNME" class="h-8 w-auto rounded-xl"/>
          <span class="text-base font-semibold tracking-tight uppercase nav-brand">ASSIGNME</span>
        </a>
        <div class="hidden md:flex items-center gap-6 text-sm text-muted">
          <a href="index.html" class="hover:text-ink">Accueil</a>
          <a href="index.html#solution" class="hover:text-ink">Solution</a>
          <a href="demo.html" class="hover:text-ink text-neon font-semibold">Démo</a>
          <a href="info.html" class="hover:text-ink">Plateforme</a>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <a href="mailto:contact@assignme.fr" class="inline-flex px-4 py-2 rounded-xl bg-ink text-black font-semibold shadow-glow hover:brightness-110">Contact</a>
      </div>
    </nav>
  </header>

  <div id="root"></div>

  <footer class="pt-12 pb-16">
    <div class="mx-auto w-[min(1100px,92%)] flex items-center justify-center">
      <div class="flex items-center gap-2">
        <img src="logo.png" alt="ASSIGNME" class="h-8 w-auto rounded-xl"/>
        <span class="text-base font-semibold footer-brand">ASSIGNME</span>
        <span class="text-muted mx-2">© 2025 ASSIGNME. Tous droits réservés | Une innovation DeepTech française</span>
      </div>
    </div>
  </footer>

  <script type="text/babel">
    const { useState, useCallback, useEffect } = React;
    
    const AssignmeAnalyzer = () => {
      const [isAnalyzing, setIsAnalyzing] = useState(false);
      const [analysisComplete, setAnalysisComplete] = useState(false);
      const [candidateProfile, setCandidateProfile] = useState(null);
      const [recommendations, setRecommendations] = useState([]);
      const [error, setError] = useState('');
      const [pdfReady, setPdfReady] = useState(false);
      const [fileName, setFileName] = useState('');
      const [progress, setProgress] = useState(0);
      const [currentStep, setCurrentStep] = useState('');

      useEffect(() => {
        if (window.pdfjsLib) {
          window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
          setPdfReady(true);
        }
      }, []);

      const updateProgress = (step, progressValue) => {
        setCurrentStep(step);
        setProgress(progressValue);
      };

      const extractTextFromPDF = async (file) => {
        if (!pdfReady) throw new Error('PDF.js non initialisé');
        updateProgress("Lecture du PDF en cours...", 20);
        
        try {
          const arrayBuffer = await file.arrayBuffer();
          const pdf = await window.pdfjsLib.getDocument(arrayBuffer).promise;
          updateProgress(`Extraction du texte (${pdf.numPages} pages)...`, 40);
          
          let fullText = '';
          for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
            const page = await pdf.getPage(pageNum);
            const textContent = await page.getTextContent();
            const pageText = textContent.items.map(item => item.str).join(' ');
            fullText += pageText + '\n\n';
          }
          
          if (fullText.trim().length === 0) throw new Error('PDF vide ou texte non extractible');
          updateProgress("Texte extrait avec succès", 60);
          return fullText;
        } catch (error) {
          throw new Error(`Erreur lecture PDF: ${error.message}`);
        }
      };

      const extractTextFromFile = async (file) => {
        const fileType = file.type;
        updateProgress(`Analyse du fichier...`, 10);
        
        if (fileType === 'application/pdf') return await extractTextFromPDF(file);
        if (fileType === 'text/plain') {
          updateProgress("Lecture du fichier texte...", 40);
          const text = await file.text();
          updateProgress("Texte lu avec succès", 60);
          return text;
        }
        
        throw new Error(`Format non supporté. Utilisez PDF ou TXT.`);
      };

      const analyzeWithNetlifyFunction = async (cvText) => {
        updateProgress("Analyse des compétences...", 70);
        
        try {
          const response = await fetch('/.netlify/functions/analyze-cv', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ cvText })
          });
          
          if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(errorData.error || `Erreur serveur`);
          }
          
          updateProgress("Recherche des opportunités...", 85);
          const result = await response.json();
          updateProgress("Matching terminé", 100);
          return result;
        } catch (error) {
          throw error;
        }
      };

      const handleFileSelect = useCallback(async (file) => {
        if (!file) return;

        const maxSize = 10 * 1024 * 1024;
        const allowedTypes = ['application/pdf', 'text/plain'];
        
        if (file.size > maxSize) {
          setError('Fichier trop volumineux (max 10MB)');
          return;
        }
        
        if (!allowedTypes.includes(file.type)) {
          setError('Format non supporté. Utilisez PDF ou TXT');
          return;
        }

        try {
          setFileName(file.name);
          setIsAnalyzing(true);
          setError('');
          setRecommendations([]);
          setAnalysisComplete(false);
          setProgress(0);

          const cvText = await extractTextFromFile(file);
          if (cvText.length < 100) throw new Error('Contenu du CV trop court');
          
          const analysis = await analyzeWithNetlifyFunction(cvText);
          
          setCandidateProfile({
            ...analysis.candidate_analysis,
            ai_metadata: analysis.ai_metadata
          });
          
          setRecommendations(analysis.recommendations || []);
          setAnalysisComplete(true);
          
        } catch (error) {
          console.error("Erreur:", error);
          setError(error.message);
          setProgress(0);
        }
        
        setIsAnalyzing(false);
      }, [pdfReady]);

      const resetAnalysis = () => {
        setAnalysisComplete(false);
        setCandidateProfile(null);
        setRecommendations([]);
        setError('');
        setFileName('');
        setProgress(0);
        setCurrentStep('');
      };

      const triggerFileInput = () => {
        if (isAnalyzing || !pdfReady) return;
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.pdf,.txt';
        input.onchange = (e) => handleFileSelect(e.target.files[0]);
        input.click();
      };

      return (
        <div className="min-h-screen pt-36 pb-24 hero-gradient">
          <div className="max-w-6xl mx-auto px-6">
            {!analysisComplete ? (
              <div>
                <div className="text-center mb-16">
                  <h1 className="text-[29.4px] md:text-[42px] leading-[99%] font-normal text-ink mb-6">
                    Testez le matching <span className="text-neon">intelligent</span>
                  </h1>
                  
                  <p className="text-lg text-muted max-w-3xl mx-auto leading-relaxed mb-8">
                    Déposez un CV et découvrez comment notre intelligence artificielle analyse les profils, extrait les compétences clés 
                    et identifie automatiquement les opportunités les plus pertinentes sur le marché français de l'emploi.
                  </p>

                  <p className="text-muted max-w-2xl mx-auto leading-relaxed">
                    Notre moteur de recommandation s'appuie sur une analyse sémantique avancée (NLP) pour aller au-delà des simples mots-clés. 
                    Il détecte les compétences transférables, évalue la compatibilité culturelle et propose des correspondances que les systèmes traditionnels manqueraient.
                  </p>
                </div>

                {error && (
                  <div className="mb-8 glass rounded-xl p-6 max-w-2xl mx-auto border-red-500/50">
                    <strong className="text-red-400">Erreur :</strong> <span className="text-red-300">{error}</span>
                  </div>
                )}

                {isAnalyzing && (
                  <div className="mb-12 glass rounded-xl p-8 max-w-3xl mx-auto">
                    <div className="mb-6">
                      <div className="w-full h-2 bg-muted/20 rounded-full overflow-hidden">
                        <div className="h-full bg-neon rounded-full transition-all duration-300" style={{width: `${progress}%`}}></div>
                      </div>
                      <p className="text-neon mt-3 text-center font-semibold">{currentStep}</p>
                      <p className="text-muted text-sm text-center mt-2">{progress}% complété</p>
                    </div>
                  </div>
                )}

                <div className="max-w-4xl mx-auto mb-16">
                  <div
                    className={`glass rounded-3xl p-20 text-center cursor-pointer transition-all duration-300 ${
                      isAnalyzing || !pdfReady ? 'opacity-50 cursor-not-allowed' : 'hover:border-neon/50 hover:shadow-glow'
                    }`}
                    onClick={triggerFileInput}
                  >
                    {isAnalyzing ? (
                      <div className="space-y-8">
                        <div className="animate-spin rounded-full h-20 w-20 border-4 border-neon/20 border-t-neon mx-auto"></div>
                        <div>
                          <p className="text-white font-bold text-3xl mb-3">Analyse en cours</p>
                          <p className="text-muted text-lg">{currentStep}</p>
                          {fileName && <p className="text-neon text-sm mt-3">{fileName}</p>}
                        </div>
                      </div>
                    ) : (
                      <div className="space-y-8">
                        <div className="text-8xl mb-6">📄</div>
                        <div>
                          <p className="text-white text-3xl font-bold mb-6">
                            Déposez un CV pour commencer
                          </p>
                          <p className="text-muted text-lg mb-8">
                            Formats acceptés : PDF, TXT • Maximum 10MB
                          </p>
                          <div className="inline-block bg-neon text-black px-8 py-4 rounded-xl font-bold text-lg hover:brightness-110 transition shadow-glow">
                            Sélectionner un fichier
                          </div>
                        </div>
                      </div>
                    )}
                  </div>
                </div>

                <div className="grid md:grid-cols-3 gap-8 max-w-5xl mx-auto mb-12">
                  <div className="glass rounded-xl p-8">
                    <h3 className="text-xl font-bold text-neon mb-3">Analyse sémantique</h3>
                    <p className="text-muted leading-relaxed">
                      Notre IA extrait intelligemment les compétences techniques, soft skills et expériences significatives. 
                      Elle comprend le contexte au-delà des mots-clés standards.
                    </p>
                  </div>
                  
                  <div className="glass rounded-xl p-8">
                    <h3 className="text-xl font-bold text-neon mb-3">Matching avancé</h3>
                    <p className="text-muted leading-relaxed">
                      Recherche vectorielle haute performance qui compare le profil à des milliers d'opportunités 
                      pour identifier les correspondances les plus pertinentes.
                    </p>
                  </div>
                  
                  <div className="glass rounded-xl p-8">
                    <h3 className="text-xl font-bold text-neon mb-3">Recommandations précises</h3>
                    <p className="text-muted leading-relaxed">
                      Chaque opportunité est accompagnée d'un score de compatibilité et d'une justification 
                      expliquant pourquoi ce poste correspond au profil.
                    </p>
                  </div>
                </div>

                <div className="glass rounded-xl p-6 max-w-3xl mx-auto text-center">
                  <p className="text-muted">
                    <strong className="text-ink">Architecture technique :</strong> Cette démonstration utilise une combinaison de NLP (traitement du langage naturel), 
                    embeddings vectoriels et recherche sémantique pour simuler l'expérience complète du moteur ASSIGNME.
                  </p>
                </div>
              </div>
            ) : (
              <div>
                <div className="glass rounded-2xl p-8 mb-8">
                  <div className="flex justify-between items-start mb-8">
                    <div className="flex-1">
                      <h2 className="text-3xl font-bold text-ink mb-2">
                        Analyse terminée
                      </h2>
                      <p className="text-muted">Profil : {candidateProfile.name || 'Candidat'}</p>
                    </div>
                    
                    <button onClick={resetAnalysis} className="px-6 py-3 glass rounded-xl text-muted hover:text-ink hover:border-neon/50 transition font-semibold">
                      Analyser un autre CV
                    </button>
                  </div>

                  <div className="grid md:grid-cols-3 gap-6 mb-8">
                    <div className="glass rounded-lg p-6">
                      <p className="text-sm text-muted mb-2">Localisation</p>
                      <p className="text-ink font-bold text-lg">{candidateProfile.location || 'Non spécifiée'}</p>
                    </div>
                    <div className="glass rounded-lg p-6">
                      <p className="text-sm text-muted mb-2">Expérience totale</p>
                      <p className="text-ink font-bold text-lg">{candidateProfile.total_experience_years || 0} années</p>
                    </div>
                    <div className="glass rounded-lg p-6">
                      <p className="text-sm text-muted mb-2">Formation</p>
                      <p className="text-ink font-bold text-lg">{candidateProfile.education_level || 'Non spécifiée'}</p>
                    </div>
                  </div>

                  {candidateProfile.technical_skills?.length > 0 && (
                    <div className="mb-6">
                      <p className="text-muted mb-3 font-semibold">Compétences techniques identifiées</p>
                      <div className="flex flex-wrap gap-2">
                        {candidateProfile.technical_skills.map((skill, i) => (
                          <span key={i} className="px-4 py-2 bg-neon/20 text-neon rounded-full border border-neon/30 font-medium">
                            {skill}
                          </span>
                        ))}
                      </div>
                    </div>
                  )}

                  {candidateProfile.soft_skills?.length > 0 && (
                    <div>
                      <p className="text-muted mb-3 font-semibold">Qualités professionnelles détectées</p>
                      <div className="flex flex-wrap gap-2">
                        {candidateProfile.soft_skills.map((skill, i) => (
                          <span key={i} className="px-4 py-2 glass rounded-full text-ink font-medium">
                            {skill}
                          </span>
                        ))}
                      </div>
                    </div>
                  )}
                </div>

                <h3 className="text-3xl font-bold text-ink mb-6">
                  {recommendations.length} opportunité{recommendations.length > 1 ? 's' : ''} identifiée{recommendations.length > 1 ? 's' : ''}
                </h3>

                <div className="space-y-6">
                  {recommendations.map((job, index) => (
                    <div key={index} className="glass rounded-xl p-8">
                      <div className="flex items-start justify-between mb-6">
                        <div className="flex-1">
                          <div className="flex items-center gap-3 mb-3">
                            <div className="w-10 h-10 bg-neon rounded-full flex items-center justify-center text-black font-bold text-lg">
                              {index + 1}
                            </div>
                            <h4 className="text-2xl font-bold text-ink">{job.job_title}</h4>
                          </div>
                          
                          <div className="flex items-center gap-4 text-muted mb-4">
                            <span className="font-semibold">{job.company}</span>
                            <span>•</span>
                            <span>{job.location}</span>
                            <span>•</span>
                            <span>{job.contract_type}</span>
                            {job.salary_display && (
                              <>
                                <span>•</span>
                                <span className="text-neon font-semibold">{job.salary_display}</span>
                              </>
                            )}
                          </div>
                        </div>
                        
                        {job.match_score && (
                          <div className="flex flex-col items-center">
                            <div className="flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-neon to-blue-400 text-black font-bold text-xl mb-2">
                              {job.match_score}%
                            </div>
                            <span className="text-xs text-muted">compatibilité</span>
                          </div>
                        )}
                      </div>
                      
                      <div className="glass rounded-lg p-6 mb-6 border border-neon/20">
                        <p className="text-sm text-muted mb-2 font-semibold">Pourquoi ce poste ?</p>
                        <p className="text-ink leading-relaxed">{job.match_justification}</p>
                      </div>

                      {job.description && (
                        <div className="mb-6">
                          <p className="text-sm text-muted mb-2 font-semibold">Description du poste</p>
                          <p className="text-muted text-sm leading-relaxed">{job.description.substring(0, 300)}...</p>
                        </div>
                      )}

                      {job.required_skills?.length > 0 && (
                        <div className="mb-6">
                          <p className="text-sm text-muted mb-2 font-semibold">Compétences recherchées</p>
                          <div className="flex flex-wrap gap-2">
                            {job.required_skills.map((skill, i) => (
                              <span key={i} className="px-3 py-1 bg-muted/10 text-muted text-xs rounded-full border border-muted/30">
                                {skill}
                              </span>
                            ))}
                          </div>
                        </div>
                      )}
                      
                      <div className="flex gap-3">
                        {job.is_real_offer && job.france_travail_url && (
                          <a href={job.france_travail_url} target="_blank" rel="noopener noreferrer" className="inline-flex px-6 py-3 rounded-xl bg-neon text-black font-bold hover:brightness-110 transition shadow-glow">
                            Voir sur France Travail
                          </a>
                        )}
                      </div>
                    </div>
                  ))}
                </div>

                <div className="mt-12 glass rounded-2xl p-8 text-center">
                  <h4 className="text-2xl font-bold text-ink mb-4">Intéressé par la plateforme ?</h4>
                  <p className="text-muted mb-6 max-w-2xl mx-auto leading-relaxed">
                    Cette démonstration illustre les capacités de matching d'ASSIGNME. La version production intègre 
                    des fonctionnalités avancées d'automatisation des candidatures et une connexion directe aux systèmes RH.
                  </p>
                  <a href="mailto:contact@assignme.fr?subject=Demande démo ASSIGNME" className="inline-flex px-8 py-4 rounded-xl bg-ink text-black font-bold shadow-glow hover:brightness-110 transition">
                    Planifier une démonstration
                  </a>
                </div>
              </div>
            )}
          </div>

          {/* Vignette France Travail en bas à droite */}
          {analysisComplete && recommendations.some(job => job.is_real_offer) && (
            <div className="fixed bottom-8 right-8 glass rounded-xl p-4 shadow-glow max-w-xs">
              <div className="flex items-center gap-3">
                <div className="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                <div>
                  <p className="text-sm font-bold text-ink">Connecté à France Travail</p>
                  <p className="text-xs text-muted">
                    {recommendations.filter(job => job.is_real_offer).length} offre(s) réelle(s) trouvée(s)
                  </p>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(React.createElement(AssignmeAnalyzer), document.getElementById('root'));
  </script>
</body>
</html>
